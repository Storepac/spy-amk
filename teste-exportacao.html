<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Exporta√ß√£o - AMK Spy</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { color: #014641; margin: 0; }
        .header p { color: #666; margin: 10px 0; }
        .test-section { margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #014641; }
        .test-section h3 { margin: 0 0 15px 0; color: #014641; }
        .btn { background: #014641; color: white; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        .btn:hover { background: #016661; }
        .btn-success { background: #28a745; }
        .btn-danger { background: #dc3545; }
        .result { margin: 10px 0; padding: 10px; background: white; border-radius: 4px; border: 1px solid #ddd; }
        .status { font-weight: bold; }
        .status.success { color: #28a745; }
        .status.error { color: #dc3545; }
        .status.warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Teste de Exporta√ß√£o</h1>
            <p>Verifica√ß√£o da funcionalidade de exporta√ß√£o com filtros</p>
        </div>

        <div class="test-section">
            <h3>üìä Status do Sistema</h3>
            <div id="system-status">Carregando...</div>
        </div>

        <div class="test-section">
            <h3>üîç Teste de Filtros</h3>
            <p>Simula produtos e testa a aplica√ß√£o de filtros:</p>
            <button class="btn" onclick="testarFiltros()">Testar Filtros</button>
            <div id="filter-results"></div>
        </div>

        <div class="test-section">
            <h3>üìã Teste de Exporta√ß√£o</h3>
            <p>Testa as funcionalidades de exporta√ß√£o:</p>
            <button class="btn" onclick="testarExportacaoCSV()">Testar CSV</button>
            <button class="btn" onclick="testarExportacaoExcel()">Testar Excel</button>
            <button class="btn btn-danger" onclick="testarExportacaoPDF()">Testar PDF</button>
            <div id="export-results"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Teste de Integra√ß√£o</h3>
            <p>Testa a integra√ß√£o entre FilterManager e ExportManager:</p>
            <button class="btn btn-success" onclick="testarIntegracao()">Testar Integra√ß√£o Completa</button>
            <div id="integration-results"></div>
        </div>
    </div>

    <!-- Carregar depend√™ncias -->
    <script>
        // Simular classes de notifica√ß√£o
        class NotificationManager {
            static mostrar(msg) { console.log('‚úÖ ' + msg); return true; }
            static sucesso(msg) { console.log('‚úÖ ' + msg); return true; }
            static erro(msg) { console.log('‚ùå ' + msg); return true; }
        }
        window.NotificationManager = NotificationManager;
    </script>
    
    <!-- Carregar componentes -->
    <script src="ui/components/FilterManager.js"></script>
    <script src="ui/export.js"></script>
    
    <script>
        // Dados de teste
        const produtosTeste = [
            {
                posicao: 1,
                titulo: "Smartphone Samsung Galaxy A54",
                asin: "B09Y1K2M3N",
                marca: "Samsung",
                preco: "R$ 1.200,00",
                precoNumerico: 1200,
                avaliacao: "4.5",
                avaliacaoNumerica: 4.5,
                numAvaliacoes: "1.234",
                vendidos: "500",
                receitaMes: 600000,
                ranking: "1500",
                categoria: "Eletr√¥nicos",
                patrocinado: false,
                organico: true,
                link: "https://amazon.com.br/test1",
                imagem: "https://via.placeholder.com/150"
            },
            {
                posicao: 2,
                titulo: "iPhone 15 Pro Max",
                asin: "B09Y1K2M4P",
                marca: "Apple",
                preco: "R$ 8.500,00",
                precoNumerico: 8500,
                avaliacao: "4.8",
                avaliacaoNumerica: 4.8,
                numAvaliacoes: "2.567",
                vendidos: "200",
                receitaMes: 1700000,
                ranking: "800",
                categoria: "Eletr√¥nicos",
                patrocinado: true,
                organico: false,
                link: "https://amazon.com.br/test2",
                imagem: "https://via.placeholder.com/150"
            },
            {
                posicao: 3,
                titulo: "Fone JBL Tune 510BT",
                asin: "B09Y1K2M5Q",
                marca: "JBL",
                preco: "R$ 299,90",
                precoNumerico: 299.90,
                avaliacao: "4.2",
                avaliacaoNumerica: 4.2,
                numAvaliacoes: "890",
                vendidos: "1200",
                receitaMes: 359880,
                ranking: "3500",
                categoria: "√Åudio",
                patrocinado: false,
                organico: true,
                link: "https://amazon.com.br/test3",
                imagem: "https://via.placeholder.com/150"
            }
        ];

        // Inicializar sistema
        let filterManager, exportManager;

        function inicializarSistema() {
            try {
                filterManager = new FilterManager();
                exportManager = new ExportManager();
                
                // Configurar produtos
                filterManager.setProdutos(produtosTeste);
                exportManager.setProdutos(produtosTeste);
                
                mostrarStatus('Sistema inicializado com sucesso!', 'success');
                return true;
            } catch (error) {
                mostrarStatus('Erro ao inicializar sistema: ' + error.message, 'error');
                return false;
            }
        }

        function mostrarStatus(mensagem, tipo = 'info') {
            const container = document.getElementById('system-status');
            container.innerHTML = `<div class="result"><span class="status ${tipo}">${mensagem}</span></div>`;
        }

        function testarFiltros() {
            const resultsDiv = document.getElementById('filter-results');
            let resultados = '';

            try {
                // Teste 1: Filtrar por marca
                filterManager.filtros.marca = 'Samsung';
                let filtrados = filterManager.filtrarProdutos();
                resultados += `<div class="result">
                    <strong>Filtro por marca "Samsung":</strong> ${filtrados.length} produto(s) encontrado(s)
                    ${filtrados.length === 1 ? '‚úÖ' : '‚ùå'}
                </div>`;

                // Teste 2: Filtrar por pre√ßo
                filterManager.filtros.marca = ''; // Limpar filtro anterior
                filterManager.filtros.preco = '1000-2000';
                filtrados = filterManager.filtrarProdutos();
                resultados += `<div class="result">
                    <strong>Filtro por pre√ßo R$ 1000-2000:</strong> ${filtrados.length} produto(s) encontrado(s)
                    ${filtrados.length === 1 ? '‚úÖ' : '‚ùå'}
                </div>`;

                // Teste 3: Filtrar por tipo
                filterManager.filtros.preco = ''; // Limpar filtro anterior
                filterManager.filtros.tipo = 'patrocinado';
                filtrados = filterManager.filtrarProdutos();
                resultados += `<div class="result">
                    <strong>Filtro por tipo "patrocinado":</strong> ${filtrados.length} produto(s) encontrado(s)
                    ${filtrados.length === 1 ? '‚úÖ' : '‚ùå'}
                </div>`;

                resultsDiv.innerHTML = resultados;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result"><span class="status error">Erro: ${error.message}</span></div>`;
            }
        }

        function testarExportacaoCSV() {
            const resultsDiv = document.getElementById('export-results');
            
            try {
                // Configurar produtos filtrados (simular filtro)
                const produtosFiltrados = produtosTeste.slice(0, 2); // Primeiros 2 produtos
                exportManager.setProdutosFiltrados(produtosFiltrados);
                
                // Testar se o m√©todo existe e funciona
                exportManager.exportarParaCSV();
                
                resultsDiv.innerHTML = `<div class="result">
                    <span class="status success">‚úÖ Exporta√ß√£o CSV testada com sucesso!</span>
                    <br>Produtos exportados: ${produtosFiltrados.length}
                </div>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result">
                    <span class="status error">‚ùå Erro no teste CSV: ${error.message}</span>
                </div>`;
            }
        }

        function testarExportacaoExcel() {
            const resultsDiv = document.getElementById('export-results');
            
            try {
                // Configurar produtos filtrados
                const produtosFiltrados = produtosTeste.filter(p => p.marca === 'Samsung');
                exportManager.setProdutosFiltrados(produtosFiltrados);
                
                // Testar exporta√ß√£o Excel
                exportManager.exportarParaExcel();
                
                resultsDiv.innerHTML += `<div class="result">
                    <span class="status success">‚úÖ Exporta√ß√£o Excel testada com sucesso!</span>
                    <br>Produtos exportados: ${produtosFiltrados.length}
                </div>`;
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result">
                    <span class="status error">‚ùå Erro no teste Excel: ${error.message}</span>
                </div>`;
            }
        }

        function testarExportacaoPDF() {
            const resultsDiv = document.getElementById('export-results');
            
            try {
                // Configurar todos os produtos para PDF
                exportManager.setProdutosFiltrados(produtosTeste);
                
                // Testar exporta√ß√£o PDF
                exportManager.exportarParaPDF();
                
                resultsDiv.innerHTML += `<div class="result">
                    <span class="status success">‚úÖ Exporta√ß√£o PDF testada com sucesso!</span>
                    <br>Relat√≥rio gerado para: ${produtosTeste.length} produtos
                    <br><small>O PDF ser√° aberto em uma nova janela para impress√£o</small>
                </div>`;
            } catch (error) {
                resultsDiv.innerHTML += `<div class="result">
                    <span class="status error">‚ùå Erro no teste PDF: ${error.message}</span>
                </div>`;
            }
        }

        function testarIntegracao() {
            const resultsDiv = document.getElementById('integration-results');
            let resultados = '';

            try {
                // Teste completo de integra√ß√£o
                
                // 1. Aplicar filtro
                filterManager.filtros.marca = 'Apple';
                const produtosFiltrados = filterManager.filtrarProdutos();
                
                // 2. Configurar exportManager com produtos filtrados
                exportManager.setProdutosFiltrados(produtosFiltrados);
                
                // 3. Verificar se getProdutosParaExportar retorna os produtos corretos
                const produtosParaExportar = exportManager.getProdutosParaExportar();
                
                resultados += `<div class="result">
                    <strong>Teste de Integra√ß√£o Completa:</strong><br>
                    ‚Ä¢ Produtos originais: ${produtosTeste.length}<br>
                    ‚Ä¢ Produtos ap√≥s filtro "Apple": ${produtosFiltrados.length}<br>
                    ‚Ä¢ Produtos para exportar: ${produtosParaExportar.length}<br>
                    ‚Ä¢ Status: ${produtosFiltrados.length === produtosParaExportar.length ? '‚úÖ Integra√ß√£o funcionando!' : '‚ùå Problema na integra√ß√£o'}
                </div>`;

                // 4. Testar c√°lculo de estat√≠sticas
                const stats = exportManager.calcularEstatisticas(produtosParaExportar);
                resultados += `<div class="result">
                    <strong>Estat√≠sticas calculadas:</strong><br>
                    ‚Ä¢ Receita Total: R$ ${stats.receitaTotal.toLocaleString('pt-BR')}<br>
                    ‚Ä¢ Vendas Totais: ${stats.vendasTotais.toLocaleString('pt-BR')}<br>
                    ‚Ä¢ Pre√ßo M√©dio: R$ ${stats.precoMedio.toFixed(2)}<br>
                    ‚Ä¢ Avalia√ß√£o M√©dia: ${stats.avaliacaoMedia.toFixed(1)} ‚≠ê
                </div>`;

                resultsDiv.innerHTML = resultados;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result">
                    <span class="status error">‚ùå Erro na integra√ß√£o: ${error.message}</span>
                </div>`;
            }
        }

        // Inicializar quando a p√°gina carregar
        window.addEventListener('load', () => {
            inicializarSistema();
        });
    </script>
</body>
</html> 