<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste ML Extractor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #00a650;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #008f44;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            background: #fef2f2;
            border-color: #fca5a5;
            color: #dc2626;
        }
        .success {
            background: #f0fdf4;
            border-color: #86efac;
            color: #059669;
        }
        .warning {
            background: #fffbeb;
            border-color: #fcd34d;
            color: #d97706;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõí Teste ML Extractor</h1>
        <p>Ferramenta para testar e debugar o extrator do MercadoLivre</p>
        
        <div>
            <button class="test-button" onclick="testarDetecaoPlataforma()">
                üåê Testar Detec√ß√£o de Plataforma
            </button>
            
            <button class="test-button" onclick="testarSeletores()">
                üéØ Testar Seletores
            </button>
            
            <button class="test-button" onclick="testarExtracao()">
                üì¶ Testar Extra√ß√£o Completa
            </button>
            
            <button class="test-button" onclick="analisarPagina()">
                üîç Analisar Estrutura da P√°gina
            </button>
            
            <button class="test-button" onclick="limparResultados()">
                üóÇÔ∏è Limpar Resultados
            </button>
        </div>
        
        <div id="resultados"></div>
    </div>

    <script>
        function mostrarResultado(titulo, conteudo, tipo = 'info') {
            const container = document.getElementById('resultados');
            const div = document.createElement('div');
            div.className = `result ${tipo}`;
            div.innerHTML = `
                <h3>${titulo}</h3>
                <pre>${typeof conteudo === 'object' ? JSON.stringify(conteudo, null, 2) : conteudo}</pre>
            `;
            container.appendChild(div);
        }

        function testarDetecaoPlataforma() {
            try {
                mostrarResultado('üåê URL Atual', window.location.href);
                
                if (typeof PlatformDetector !== 'undefined') {
                    const platform = PlatformDetector.detectPlatform();
                    mostrarResultado('‚úÖ Plataforma Detectada', platform, 'success');
                } else {
                    mostrarResultado('‚ùå PlatformDetector n√£o carregado', 'Classe n√£o dispon√≠vel', 'error');
                }
            } catch (error) {
                mostrarResultado('‚ùå Erro na detec√ß√£o', error.message, 'error');
            }
        }

        function testarSeletores() {
            try {
                const seletores = {
                    'Itens de busca': '.ui-search-layout__item',
                    'T√≠tulos': '.poly-component__title',
                    'Pre√ßos': '.andes-money-amount__fraction',
                    'Imagens': '.poly-component__picture',
                    'Avalia√ß√µes': '.poly-reviews__rating',
                    'Vendedores': '.poly-component__seller'
                };

                const resultado = {};
                
                for (const [nome, seletor] of Object.entries(seletores)) {
                    const elementos = document.querySelectorAll(seletor);
                    resultado[nome] = {
                        seletor: seletor,
                        encontrados: elementos.length,
                        primeiros3: Array.from(elementos).slice(0, 3).map(el => 
                            el.textContent ? el.textContent.trim().substring(0, 100) : 'Sem texto'
                        )
                    };
                }

                mostrarResultado('üéØ Teste de Seletores', resultado, 'info');
                
            } catch (error) {
                mostrarResultado('‚ùå Erro nos seletores', error.message, 'error');
            }
        }

        function testarExtracao() {
            try {
                if (typeof MLExtractor === 'undefined') {
                    mostrarResultado('‚ùå MLExtractor n√£o carregado', 'Classe n√£o dispon√≠vel', 'error');
                    return;
                }

                console.log('üöÄ Iniciando teste de extra√ß√£o...');
                const produtos = MLExtractor.extrairProdutos();
                
                if (produtos && produtos.length > 0) {
                    mostrarResultado('‚úÖ Extra√ß√£o Bem-sucedida', {
                        total: produtos.length,
                        primeiro: produtos[0],
                        resumo: produtos.map(p => ({
                            titulo: p.titulo?.substring(0, 50) + '...',
                            preco: p.preco,
                            mlId: p.mlId,
                            vendedor: p.vendedor,
                            vendas: p.vendas,
                            vendasTexto: p.vendasTexto,
                            maisVendido: p.maisVendido,
                            recomendado: p.recomendado,
                            patrocinado: p.patrocinado,
                            categoria: p.categoria,
                            posicaoCategoria: p.posicaoCategoria
                        })).slice(0, 3)
                    }, 'success');
                    
                    // Testar tabela ML
                    testarTabelaML(produtos);
                } else {
                    mostrarResultado('‚ö†Ô∏è Nenhum produto extra√≠do', 'Array vazio ou null', 'warning');
                }
                
            } catch (error) {
                mostrarResultado('‚ùå Erro na extra√ß√£o', error.message, 'error');
            }
        }
        
        function testarTabelaML(produtos) {
            try {
                if (typeof TableManager === 'undefined') {
                    mostrarResultado('‚ö†Ô∏è TableManager n√£o dispon√≠vel', 'Classe n√£o carregada', 'warning');
                    return;
                }
                
                if (typeof TableRowBuilder === 'undefined') {
                    mostrarResultado('‚ö†Ô∏è TableRowBuilder n√£o dispon√≠vel', 'Classe n√£o carregada', 'warning');
                    return;
                }
                
                console.log('üìä Testando cria√ß√£o de tabela ML...');
                
                // Testar cria√ß√£o da tabela
                const tabelaHTML = TableManager.criarTabelaProdutos(produtos);
                
                if (tabelaHTML && tabelaHTML.length > 0) {
                    mostrarResultado('‚úÖ Tabela ML criada com sucesso!', {
                        tamanho: tabelaHTML.length,
                        temCabecalho: tabelaHTML.includes('MLB'),
                        temVendedor: tabelaHTML.includes('Vendedor'),
                        temBadge: tabelaHTML.includes('Badge'),
                        width95: tabelaHTML.includes('width: 95%')
                    }, 'success');
                    
                    // Criar modal de demonstra√ß√£o
                    criarModalDemostracao(produtos, tabelaHTML);
                } else {
                    mostrarResultado('‚ùå Erro ao criar tabela ML', 'HTML vazio ou inv√°lido', 'error');
                }
                
            } catch (error) {
                mostrarResultado('‚ùå Erro no teste da tabela ML', error.message, 'error');
            }
        }
        
        function criarModalDemostracao(produtos, tabelaHTML) {
            // Criar modal para demonstrar a tabela
            const modal = document.createElement('div');
            modal.id = 'demo-ml-modal';
            modal.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                right: 20px;
                bottom: 20px;
                background: white;
                border: 3px solid #FFE600;
                border-radius: 12px;
                z-index: 999999;
                overflow: auto;
                padding: 20px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
                font-family: 'Poppins', Arial, sans-serif;
            `;
            
            modal.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #FFE600;">
                    <h2 style="margin: 0; color: #333; font-size: 20px;">
                        üõí Demo Tabela ML - ${produtos.length} produtos
                    </h2>
                    <button onclick="document.getElementById('demo-ml-modal').remove()" 
                            style="background: #ff4444; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                        ‚úï Fechar
                    </button>
                </div>
                <div style="max-height: calc(100vh - 140px); overflow: auto;">
                    ${tabelaHTML}
                </div>
            `;
            
            // Remover modal anterior se existir
            const existing = document.getElementById('demo-ml-modal');
            if (existing) existing.remove();
            
            document.body.appendChild(modal);
            
            // Inicializar eventos da tabela
            setTimeout(() => {
                if (window.TableManager && typeof TableManager.inicializarEventos === 'function') {
                    TableManager.inicializarEventos();
                }
            }, 100);
            
            mostrarResultado('üéâ Modal de demonstra√ß√£o criado!', 'Tabela ML exibida em modal', 'success');
        }

        function analisarPagina() {
            try {
                const analise = {
                    url: window.location.href,
                    title: document.title,
                    estrutura: {
                        'ui-search-layout__item': document.querySelectorAll('.ui-search-layout__item').length,
                        'poly-component__title': document.querySelectorAll('.poly-component__title').length,
                        'andes-money-amount__fraction': document.querySelectorAll('.andes-money-amount__fraction').length,
                        'poly-component__picture': document.querySelectorAll('.poly-component__picture').length
                    },
                    exemplos: {
                        primeiroItem: (() => {
                            const primeiro = document.querySelector('.ui-search-layout__item');
                            if (primeiro) {
                                return {
                                    classes: primeiro.className,
                                    html: primeiro.outerHTML.substring(0, 500) + '...'
                                };
                            }
                            return 'N√£o encontrado';
                        })(),
                        primeiroTitulo: (() => {
                            const titulo = document.querySelector('.poly-component__title');
                            return titulo ? titulo.textContent.trim() : 'N√£o encontrado';
                        })(),
                        primeiroPreco: (() => {
                            const preco = document.querySelector('.andes-money-amount__fraction');
                            return preco ? preco.textContent.trim() : 'N√£o encontrado';
                        })()
                    }
                };

                mostrarResultado('üîç An√°lise da P√°gina', analise, 'info');
                
            } catch (error) {
                mostrarResultado('‚ùå Erro na an√°lise', error.message, 'error');
            }
        }

        function limparResultados() {
            document.getElementById('resultados').innerHTML = '';
        }

        // Executar automaticamente ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            mostrarResultado('üéâ Teste ML Extractor Carregado', `
                Ferramenta carregada com sucesso!
                
                Instru√ß√µes:
                1. Navegue at√© uma p√°gina de busca do MercadoLivre
                2. Execute os testes usando os bot√µes acima
                3. Verifique os resultados para identificar problemas
                
                URL atual: ${window.location.href}
            `, 'success');
        });

        // Fun√ß√£o para executar no console
        window.debugMLExtractor = function() {
            console.log('üîç === DEBUG ML EXTRACTOR ===');
            
            // Verificar se classes est√£o carregadas
            console.log('MLExtractor dispon√≠vel:', typeof MLExtractor !== 'undefined');
            console.log('PlatformDetector dispon√≠vel:', typeof PlatformDetector !== 'undefined');
            
            // Detectar plataforma
            if (typeof PlatformDetector !== 'undefined') {
                const platform = PlatformDetector.detectPlatform();
                console.log('Plataforma detectada:', platform);
            }
            
            // Testar seletores
            console.log('\nüéØ Testando seletores:');
            const seletores = [
                '.ui-search-layout__item',
                '.poly-component__title',
                '.andes-money-amount__fraction',
                '.poly-component__picture'
            ];
            
            seletores.forEach(seletor => {
                const elementos = document.querySelectorAll(seletor);
                console.log(`  ${seletor}: ${elementos.length} elementos`);
                if (elementos.length > 0) {
                    console.log(`    Primeiro: ${elementos[0].textContent?.trim().substring(0, 50) || 'Sem texto'}`);
                }
            });
            
            // Tentar extra√ß√£o
            if (typeof MLExtractor !== 'undefined') {
                console.log('\nüì¶ Testando extra√ß√£o:');
                try {
                    const produtos = MLExtractor.extrairProdutos();
                    console.log(`Produtos extra√≠dos: ${produtos ? produtos.length : 0}`);
                    if (produtos && produtos.length > 0) {
                        console.log('Primeiro produto:', produtos[0]);
                    }
                } catch (error) {
                    console.error('Erro na extra√ß√£o:', error);
                }
            }
            
            console.log('üîç === FIM DEBUG ===');
        };

        // Expor fun√ß√£o globalmente
        console.log('üí° Execute window.debugMLExtractor() no console para debug completo');
    </script>
</body>
</html> 