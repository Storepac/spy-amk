<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Filtros Avan√ßados - SidePanel AMK Spy</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #014641;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .teste-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #014641;
        }

        .teste-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #014641;
            margin-bottom: 15px;
        }

        .botao-teste {
            background: linear-gradient(135deg, #014641, #013935);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .botao-teste:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(1, 70, 65, 0.3);
        }

        .resultado {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .log {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }

        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Teste Filtros Avan√ßados</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            Sistema de filtros inteligentes para an√°lise de produtos Amazon
        </p>

        <div class="teste-section">
            <div class="teste-title">üîß Carregamento dos Componentes</div>
            <button class="botao-teste" onclick="carregarComponentes()">Carregar SidePanel</button>
            <button class="botao-teste" onclick="abrirSidePanel()">Abrir Painel Lateral</button>
            <div class="resultado" id="resultado-componentes"></div>
        </div>

        <div class="teste-section">
            <div class="teste-title">üéõÔ∏è Teste dos Filtros</div>
            <button class="botao-teste" onclick="testarToggleBSR()">Toggle BSR ‚â§ 100</button>
            <button class="botao-teste" onclick="testarFiltrosPreco()">Filtros de Pre√ßo</button>
            <button class="botao-teste" onclick="testarFiltrosBSR()">Filtros BSR Personalizado</button>
            <button class="botao-teste" onclick="testarFiltrosVendas()">Filtros de Vendas</button>
            <div class="resultado" id="resultado-filtros"></div>
        </div>

        <div class="teste-section">
            <div class="teste-title">üìä Simula√ß√£o de Produtos</div>
            <button class="botao-teste" onclick="criarProdutosTeste()">Criar Produtos de Teste</button>
            <button class="botao-teste" onclick="aplicarFiltrosTeste()">Aplicar Filtros</button>
            <button class="botao-teste" onclick="mostrarResultados()">Ver Resultados</button>
            <div class="resultado" id="resultado-produtos"></div>
        </div>

        <div class="info">
            <strong>üí° Como Testar:</strong><br>
            1. Carregue os componentes<br>
            2. Abra o painel lateral (bot√£o üîç)<br>
            3. Configure os filtros desejados<br>
            4. Teste as funcionalidades interativas<br>
            5. Simule produtos para verificar aplica√ß√£o dos filtros
        </div>

        <div class="log" id="log-console"></div>
    </div>

    <div class="status" id="status"></div>

    <!-- Incluir componentes necess√°rios -->
    <script src="ui/components/SidePanel.js"></script>
    <script src="ui/notifications.js"></script>

    <script>
        // Mock do NotificationManager se n√£o existir
        if (typeof NotificationManager === 'undefined') {
            window.NotificationManager = {
                informacao: (msg) => showStatus(msg, 'info'),
                sucesso: (msg) => showStatus(msg, 'success'),
                erro: (msg) => showStatus(msg, 'error')
            };
        }

        // Sistema de log
        function log(message) {
            const logElement = document.getElementById('log-console');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function showStatus(message, type = 'info') {
            const status = document.getElementById('status');
            const colors = {
                info: '#2196F3',
                success: '#4CAF50',
                error: '#F44336'
            };
            
            status.style.backgroundColor = colors[type] || colors.info;
            status.textContent = message;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
            
            log(`${type.toUpperCase()}: ${message}`);
        }

        function mostrarResultado(sectionId, message) {
            const resultado = document.getElementById(sectionId);
            resultado.innerHTML = message;
            resultado.style.display = 'block';
        }

        // Testes dos componentes
        function carregarComponentes() {
            try {
                if (typeof SidePanel !== 'undefined') {
                    SidePanel.init();
                    mostrarResultado('resultado-componentes', '‚úÖ SidePanel carregado com sucesso!');
                    log('SidePanel inicializado');
                } else {
                    mostrarResultado('resultado-componentes', '‚ùå SidePanel n√£o encontrado');
                    log('ERRO: SidePanel n√£o encontrado');
                }
            } catch (error) {
                mostrarResultado('resultado-componentes', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        function abrirSidePanel() {
            try {
                if (typeof SidePanel !== 'undefined') {
                    SidePanel.abrir();
                    mostrarResultado('resultado-componentes', '‚úÖ Painel lateral aberto!');
                    log('Painel lateral aberto');
                } else {
                    mostrarResultado('resultado-componentes', '‚ùå SidePanel n√£o carregado');
                    log('ERRO: SidePanel n√£o carregado');
                }
            } catch (error) {
                mostrarResultado('resultado-componentes', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        // Testes dos filtros
        function testarToggleBSR() {
            try {
                const filtros = {
                    bsrTop100: true,
                    precoMin: null,
                    precoMax: null,
                    bsrMin: null,
                    bsrMax: null,
                    vendasMin: null,
                    vendasMax: null
                };

                // Simular ativa√ß√£o do toggle
                sessionStorage.setItem('amk_filtros_analise', JSON.stringify(filtros));
                
                mostrarResultado('resultado-filtros', '‚úÖ Toggle BSR ‚â§ 100 ativado! Filtros BSR personalizados desabilitados.');
                log('Toggle BSR ‚â§ 100 testado com sucesso');
            } catch (error) {
                mostrarResultado('resultado-filtros', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        function testarFiltrosPreco() {
            try {
                const filtros = {
                    bsrTop100: false,
                    precoMin: 50.00,
                    precoMax: 200.00,
                    bsrMin: null,
                    bsrMax: null,
                    vendasMin: null,
                    vendasMax: null
                };

                sessionStorage.setItem('amk_filtros_analise', JSON.stringify(filtros));
                
                mostrarResultado('resultado-filtros', '‚úÖ Filtros de pre√ßo configurados: R$ 50,00 - R$ 200,00');
                log('Filtros de pre√ßo testados: R$ 50 - R$ 200');
            } catch (error) {
                mostrarResultado('resultado-filtros', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        function testarFiltrosBSR() {
            try {
                const filtros = {
                    bsrTop100: false,
                    precoMin: null,
                    precoMax: null,
                    bsrMin: 1,
                    bsrMax: 1000,
                    vendasMin: null,
                    vendasMax: null
                };

                sessionStorage.setItem('amk_filtros_analise', JSON.stringify(filtros));
                
                mostrarResultado('resultado-filtros', '‚úÖ Filtros BSR personalizados: #1 - #1000');
                log('Filtros BSR personalizados testados: #1 - #1000');
            } catch (error) {
                mostrarResultado('resultado-filtros', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        function testarFiltrosVendas() {
            try {
                const filtros = {
                    bsrTop100: false,
                    precoMin: null,
                    precoMax: null,
                    bsrMin: null,
                    bsrMax: null,
                    vendasMin: 100,
                    vendasMax: 5000
                };

                sessionStorage.setItem('amk_filtros_analise', JSON.stringify(filtros));
                
                mostrarResultado('resultado-filtros', '‚úÖ Filtros de vendas configurados: 100 - 5000 vendas/m√™s');
                log('Filtros de vendas testados: 100 - 5000');
            } catch (error) {
                mostrarResultado('resultado-filtros', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        // Simula√ß√£o de produtos
        let produtosTeste = [];

        function criarProdutosTeste() {
            produtosTeste = [
                {
                    titulo: "Produto Elite BSR",
                    asin: "B001",
                    precoNumerico: 89.90,
                    ranking: 50,
                    vendidos: 1500,
                    posicaoGlobal: 1
                },
                {
                    titulo: "Produto Caro High-End",
                    asin: "B002", 
                    precoNumerico: 299.90,
                    ranking: 150,
                    vendidos: 800,
                    posicaoGlobal: 2
                },
                {
                    titulo: "Produto Barato Baixo BSR",
                    asin: "B003",
                    precoNumerico: 29.90,
                    ranking: 5000,
                    vendidos: 50,
                    posicaoGlobal: 3
                },
                {
                    titulo: "Produto M√©dio Vendas Altas",
                    asin: "B004",
                    precoNumerico: 149.90,
                    ranking: 250,
                    vendidos: 3000,
                    posicaoGlobal: 4
                },
                {
                    titulo: "Produto Top 100 BSR",
                    asin: "B005",
                    precoNumerico: 75.50,
                    ranking: 80,
                    vendidos: 2200,
                    posicaoGlobal: 5
                }
            ];

            mostrarResultado('resultado-produtos', `‚úÖ ${produtosTeste.length} produtos de teste criados!`);
            log(`${produtosTeste.length} produtos de teste criados`);
        }

        function aplicarFiltrosTeste() {
            try {
                // Carregar filtros do sessionStorage
                const filtrosSalvos = sessionStorage.getItem('amk_filtros_analise');
                if (!filtrosSalvos) {
                    mostrarResultado('resultado-produtos', '‚ö†Ô∏è Configure filtros primeiro!');
                    return;
                }

                const filtros = JSON.parse(filtrosSalvos);
                
                // Usar a fun√ß√£o do SidePanel se dispon√≠vel
                let produtosFiltrados;
                if (typeof SidePanel !== 'undefined' && SidePanel.aplicarFiltrosProdutos) {
                    produtosFiltrados = SidePanel.aplicarFiltrosProdutos(produtosTeste, filtros);
                } else {
                    // Fallback: aplicar filtros localmente
                    produtosFiltrados = produtosTeste.filter(produto => {
                        if (filtros.bsrTop100) {
                            const bsr = parseInt(produto.ranking || 0);
                            if (bsr > 100 || bsr === 0) return false;
                        }

                        if (!filtros.bsrTop100 && (filtros.bsrMin || filtros.bsrMax)) {
                            const bsr = parseInt(produto.ranking || 0);
                            if (filtros.bsrMin && bsr < filtros.bsrMin) return false;
                            if (filtros.bsrMax && bsr > filtros.bsrMax) return false;
                        }

                        if (filtros.precoMin || filtros.precoMax) {
                            const preco = produto.precoNumerico || 0;
                            if (filtros.precoMin && preco < filtros.precoMin) return false;
                            if (filtros.precoMax && preco > filtros.precoMax) return false;
                        }

                        if (filtros.vendasMin || filtros.vendasMax) {
                            const vendas = parseInt(produto.vendidos || 0);
                            if (filtros.vendasMin && vendas < filtros.vendasMin) return false;
                            if (filtros.vendasMax && vendas > filtros.vendasMax) return false;
                        }

                        return true;
                    });
                }

                window.produtosFiltradosTeste = produtosFiltrados;
                
                mostrarResultado('resultado-produtos', 
                    `‚úÖ Filtros aplicados: ${produtosTeste.length} ‚Üí ${produtosFiltrados.length} produtos`);
                log(`Filtros aplicados: ${produtosTeste.length} ‚Üí ${produtosFiltrados.length} produtos`);
                
            } catch (error) {
                mostrarResultado('resultado-produtos', `‚ùå Erro: ${error.message}`);
                log(`ERRO: ${error.message}`);
            }
        }

        function mostrarResultados() {
            if (!window.produtosFiltradosTeste) {
                mostrarResultado('resultado-produtos', '‚ö†Ô∏è Execute "Aplicar Filtros" primeiro!');
                return;
            }

            const produtos = window.produtosFiltradosTeste;
            let html = `<strong>üìä Produtos que passaram pelos filtros (${produtos.length}):</strong><br><br>`;
            
            produtos.forEach((produto, index) => {
                html += `
                    <div style="background: white; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #014641;">
                        <strong>${index + 1}. ${produto.titulo}</strong><br>
                        üí∞ R$ ${produto.precoNumerico?.toFixed(2)} | 
                        üèÜ BSR #${produto.ranking} | 
                        üìà ${produto.vendidos} vendas
                    </div>
                `;
            });

            if (produtos.length === 0) {
                html += '<div style="text-align: center; color: #666;">Nenhum produto passou pelos filtros configurados</div>';
            }

            mostrarResultado('resultado-produtos', html);
            log(`Exibindo ${produtos.length} produtos filtrados`);
        }

        // Inicializa√ß√£o
        window.onload = function() {
            log('P√°gina de teste carregada');
            showStatus('P√°gina de teste carregada! Use os bot√µes para testar os filtros.', 'info');
        };
    </script>
</body>
</html> 